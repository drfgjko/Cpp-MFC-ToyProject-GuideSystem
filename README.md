# 导游系统

## 项目描述

该项目是一个基于MFC（Microsoft Foundation Classes）的导游系统，旨在为用户提供从校园正门到各景点的最短路径推荐和不重复游览的完整路线。用户可以通过界面输入起点和终点，系统能够自动读取预先存储的导游图文件，并利用算法计算最优路径。

### 技术选型

- **开发环境**：Visual Studio 2022
- **编程语言**：C++
- **界面框架**：MFC（Microsoft Foundation Classes）用于构建图形用户界面（GUI）
- **算法**：
  - **Floyd算法**：用于计算任意两点之间的最短路径。
  - **回溯算法**：用于生成不重复游览所有景点的推荐路线。
- **数据结构**：使用邻接矩阵存储带权无向图，支持高效的图遍历和路径查找。
- **文件处理**：支持从文本文件中读取导游图数据，实现动态图的构建。

该系统结合了图论算法和MFC界面设计，为用户提供直观的导航体验。

### 项目说明

- 仅为综合实训报告的简易版归纳
- GuideSystem文件夹为源代码

### 运行说明

- 请保证.**msj**和.**exe**文件都运行过

## 综合实训报告

### 1. 完成情况

独立完成MFC界面搭建，文件读取、计算两点最短路径、输出推荐路线、图片切换及读取多个txt等基本功能实现。

### 2. 问题描述和基本要求

#### 2.1 问题描述

假设给出一张华师南海校区的导游图，游客通过终端询问从某一景点到另一景点的最短路径。能显示游客从校园正门进入，使游客可以不重复地游览各校园景点，最后回到校园正门的路线。

#### 2.2 基本要求

1. 将导游图（带权无向图）信息存入文件中，程序运行时可自动读入文件建立相关数据结构；
2. 从入口（正门）到出口（正门）不重复地游览所有景点的线路；
3. 输入两个景点，就可以得到其最短线路，即：路程最短的行进方法；如果两者无线路可通，就得出“两景点不可达的信息”；
4. 显示线路时应同时显示路径长度。

### 3. 工具/准备工作

#### 3.1 综合实验中涉及的数据结构知识

文件的读取算法，两点最短路径Floyd算法，递归回溯策略。

#### 3.2 使用的C++集成开发环境

Visual Studio 2022。

### 4. 分析与实现

#### 4.1 分析综合实验项目的实现方法

围绕基本要求，提出实现方法，内容如下：
1. 将导游图（带权无向图）信息存入文件中，程序运行时可自动读入文件建立相关数据结构 → 用文件的读取算法读取数据。
2. 从入口（正门）到出口（正门）不重复地游览所有景点的线路 → 用回溯算法计算解决推荐路径问题。
3. 输入两个景点，就可以得到其最短线路，即：路程最短的行进方法；如果两者无线路可通，就得出“两景点不可达的信息” → 用Floyd算法计算解决最短路径问题。
4. 显示线路时应同时显示路径长度 → 规定好输出格式。

#### 4.2 采用适当的数据结构与算法

##### 4.2.1 根据特定格式的txt文件用文件输入流获得相应信息并生成对应的带权无向图
每个按钮下都会再次生成一张新的MGraph，然后在此基础上调用Change()函数去更改内部数据，以实现读取多张图计算最佳路径的功能。项目依赖编辑框IDC_EDIT3。

**读取及构造的算法实现：**
```cpp
//读取别的txt（地图）
void MGraph::Change(int x) {
    // ...
};
```

##### 4.2.2 根据floyd算法求最短路径
每次构造新图并Change（）设置数据后，都会调用Floyd（）来设置int dist[MaxSize][MaxSize]和string path[MaxSize][MaxSize]的数据。在此数据的基础上调用Mytools的Mysplit（）对目标字符串进行简单加工。

**根据floyd算法求最短路径的算法实现：**
```cpp
//参照书本P200
void MGraph::Floyd()
{
    int i, j, k;
    //...
};
```

##### 4.2.3.用回溯算法求推荐的路线
按钮关联getRoad()，getRoad()内部调用backTracing（）回溯递归算法，生成目标数据，后调用Mytools类中的Mysplit2（）对目标字符串进行简单加工。

**回溯算法实现：**
```cpp
//获取浏览路线
string MGraph::getRoad()
{
    //...
};

//递归
void MGraph::backTracing(int x)
{
    //...
};

字符串加工实现：
//根据换行符分割，只取最后一行
string MyTools::Mysplit2(string s)
{
    //...
};
```

#### 4.3 给出各个函数之间调用关系
各功能实现关联函数展示结构如下：
4.3.1图片展示
4.3.2 清空
4.3.3 退出
4.3.4 最短路径
4.3.5 推荐路线

##### 4.3.1 图片展示
OnBnclickedButton_（）函数会生成新图并更改图片。生成新MGraph类后调用Change（）函数设置构建对应的图，以便调用getVertex()函数输出到静态文本框。Change（）会调用Floyd（）生成path和dist二维数组，而Floyd（）又会依赖于Mysplit去处理字符串获得需要的path二维数组。

（图 1 类图-UML）

##### 4.3.2 清空

（图 2 “清空”控件函数）

##### 4.3.3 退出

（图 3 “退出”控件函数调用关系）

##### 4.3.4 最短路径

OnBnclickedButton_（）函数会生成新图、更改数据、生成目标数组、数据。生成新MGraph类后调用Change（）函数设置构建对应的图，Change（）会调用Floyd（），而在设置int dist[MaxSize][MaxSize]和string path[MaxSize][MaxSize]的数据时，会调用Mytools的Mysplit（）对目标字符串进行简单加工，得到需要的string path[MaxSize][MaxSize]。 最后ShortPath（）则直接使用上述函数处理后的path和dist数组进行输出。

（图 4 “最短路径”控件函数调用关系）

##### 4.3.5 推荐路线

OnBnclickedButton_（）函数会生成新图、更改数据、生成目标数组、数据。生成新MGraph类后调用Change（）函数设置构建对应的图，Change（）会调用Floyd（），而在设置int dist[MaxSize][MaxSize]和string path[MaxSize][MaxSize]的数据时，会调用Mytools的Mysplit（）对目标字符串进行简单加工，得到处理后的string path[MaxSize][MaxSize]。 同时Change（）还会初始化、构建好backTraing（）函数需要的tmp二维数组，以及中间数组in，最短距离bets，某条路线的当前长度len以及字符串road路线。在Change（）执行完毕后，会继续调用getRoad（）获取backTracing（）处理后的road字符串以及最短距离best。OnBnclickedButton_（）在getRoad（）执行完毕后，对road字符串调用Mysplit2（）进行简单的加工，并输出。

（图 5 “推荐路线”控件函数调用关系）

### 5. 测试与结论
展示结构如下：
5.1界面主体展示
5.2退出
5.3展示按钮
	5.3.1输出南海校区地图
	5.3.2输出石牌校区地图
	5.3.3输出大学城校区地图
5.4最短路径
	5.4.1编辑框未满的情况
		5.4.1.1	景点框未输入
		5.4.1.2	标号框未输入
	5.4.2编辑框输入错误的情况
		5.4.2.1	景点输入错误
		5.4.21	标号输入错误
	5.4.3 编辑框输入正确且补齐
		5.4.3.1 路径存在
		5.4.3.2 路径不存在
5.5清空
5.6推荐路径
	5.6.1编辑框未满的情况（标号框未输入）
	5.6.2编辑框输入错误的情况（标号输入错误）
	5.6.3 编辑框输入正确且补齐
		5.6.3.1 路径存在
		5.6.3.2 路径不存在

### 6. 综合实验总结

#### 6.1算法介绍

通过建立MGraph类构建无向带权图，采用邻接矩阵的存储逻辑。调用内部如Floyd等函数实现项目要求。MGraph类成员函数有一个Mytools类，定义为辅助工具，里面放置一些自己写的数学方法，和对获取的字符串进行相应处理的函数。MFC上将按钮与MGraph类的成员函数调用关联起来。用于求两点之间最短路径的算法，最核心的Floyd算法是参考书本代码，然后根据实际应用修改的。实际获取两点最短路线的函数则是Mytools类中很简单的string切割之类的操作。求推荐路线的算法，则是按照老师给出的提示采用回溯策略利用递归去求解，最后同样调用Mytools类中很简单的string切割进行相应操作。

#### 6.2学习创新创作

对于创新，在功能上，我按照实际（但地图并不是真实的）实装了切换多张地图的功能，可以展示不同的地图，在寻找路线时也可以读取对应地图上数据。只是很简单的功能扩展，通过button和为picturecontrol控件添加变量，设置HBitmap来实现。对于各张地图的不同景点条件下的最短路径的查找，这个是通过MGraph类内的Change（）函数实现的，非常依赖于我在后续添加的编辑框Static_Edit3，按钮获取编辑框数据，即对应的地图标号，然后生产新MGraph，调用Change（），将成员变量重新设置好，然后就与最基础的项目底层程序没有太大区别。我目前还做不到在算法上改进，这也是后续需要提到的不足之处。对于学习，我了解到该类问题可以在限定条件上改进。如屈婉玲老师讲过的界定函数，更精确的利用界定函数削减分支。但只是了解，没有深入学习。这是今后可以改进的地方。[算法使用见](https://blog.csdn.net/qq_34793133/article/details/80724177)。我个人认为自己有较良好的注释习惯，在我的代码中可以看到我把很多错误、不起作用的代码留了下来，这些注释记录了我很多在做项目过程中遇到的问题，我觉得对于我的学习帮助很大。

#### 6.3需要更进一步了解和帮助

程序不足之处，或者说是可以改进的地方，我觉得还是功能实现内部的程序太不简洁了。我还是没有学会在MFC上创建全局变量，导致要靠重复生成类并写多个操作函数才能实现功能。这从我的代码里很容易就看得出来，每个button下都会再次生成一张新的MGraph，然后才再此基础上调用Change（）函数去更改内部数据，以实现读取多张图计算最佳路径的功能。我的这个项目非常依赖编辑框IDC_EDIT3。以及还不是很能很好地使用MFC初始化函数。算法也肯定还有很多可优化的地方，目前我还是停留在很简单地从书本上摘抄改写的程度。

#### 6.4感悟
这次项目锻炼了我文件读取、MFC、类的创建与调用的能力，对递归与回溯相辅相成的关系有了更深刻的理解。也让我对数据结构与算法有了更深刻的认识。

在另一门编程语言课程的学习中学习过可视化编程并能实现基础的可视化与sql管理结合的前情提要下本身对该课程设计的可视化编程有一定信心，而且数据结构课程重点在算法实现，本课程设计只是简单涉及可视化编程，但实际上手还是会感叹原来学习一款新软件还是需要一定的时间精力的。MFC可能是一个你刚开始接触会找不到门路，但掌握最最基本的用法后就没有看上去那么可怕的存在。感谢万能的互联网，也不那么感谢互联网，由于教程过多，反而有些影响判断。但当时学会使用静态文本框时的喜悦是忘不了的。

相似的，设计重心在于核心的算法实现，主要是Floyd和“货郎问题”、回溯策略等内容，但我还是被非常基础的、不算涉及核心的“文件读取”操作绊住了脚步。在之前，我就是非常抗拒文件读取相关的知识，这次选择这个课题，于我而言是一个非常有勇气和相当有进步的表现。我一开始特别焦虑，因为觉得自己在文件读取方面一点都没有掌握。但也只能去搜，去看。很多教学用例都不符合我实际使用，而又由于不清楚知识点，而不知道如何描述和找到切入点，进度相对缓慢。就算找到使用形式相似的，对方使用的IDE也是QT。最终的最终，虽然方法很笨，但也实现了txt读取及无向图构建。

要求之一的求两点之间最短路径，因为有书本参考以及课堂学习，所以没有耗费太多精力。第二个推荐路线，即使有老师的提醒，“使用回溯策略”，有了一定的方向和眉目，但学会调用在实际程序中仍然花费了我不少时间。我本身对于递归就是一种不太理解的情况，而这次的算法则是回溯与递归相融的。虽然过程很痛苦，但是顺利把项目完成的心情还是很值得记录的。
#### 7. 附录: 源代码
